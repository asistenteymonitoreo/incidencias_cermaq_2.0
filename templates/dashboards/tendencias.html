{% extends 'dashboards/base_dashboard.html' %}
{% load static %}

{% block title %}Tendencias y Predicciones{% endblock %}

{% block content %}
<h1>ğŸ“ˆ Tendencias y Predicciones</h1>
<p class="dashboard-subtitle">AnÃ¡lisis histÃ³rico y proyecciones</p>

<section class="metrics-grid">
    <div class="metric-card">
        <div class="metric-icon">ğŸ“Š</div>
        <div class="metric-content">
            <h3>30</h3>
            <p>DÃ­as Analizados</p>
        </div>
    </div>
    <div class="metric-card">
        <div class="metric-icon">ğŸ“ˆ</div>
        <div class="metric-content">
            <h3 id="tendencia-valor">0%</h3>
            <p>Tendencia</p>
        </div>
    </div>
    <div class="metric-card">
        <div class="metric-icon">âš ï¸</div>
        <div class="metric-content">
            <h3>{{ anomalias|length }}</h3>
            <p>AnomalÃ­as Detectadas</p>
        </div>
    </div>
    <div class="metric-card">
        <div class="metric-icon">ğŸ¯</div>
        <div class="metric-content">
            <h3 id="promedio-movil">0</h3>
            <p>Promedio MÃ³vil</p>
        </div>
    </div>
</section>

<section class="dashboard-charts-grid">
    <div class="chart-card">
        <h3>ğŸ“ˆ Tendencia de Incidencias (30 dÃ­as)</h3>
        <canvas id="chartTendenciaIncidencias"></canvas>
    </div>
    
    <div class="chart-card">
        <h3>ğŸŒ¡ï¸ EvoluciÃ³n de ParÃ¡metros</h3>
        <canvas id="chartEvolucionParametros"></canvas>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
    const tendenciaLabels = {{ tendencia_labels|safe }};
    const tendenciaData = {{ tendencia_data|safe }};
    const promedioMovil = {{ promedio_movil|safe }};
    
    // GrÃ¡fico de tendencia
    new Chart(document.getElementById('chartTendenciaIncidencias'), {
        type: 'line',
        data: {
            labels: tendenciaLabels,
            datasets: [{
                label: 'Incidencias',
                data: tendenciaData,
                borderColor: '#17a2b8',
                backgroundColor: 'rgba(23, 162, 184, 0.1)',
                tension: 0.4
            }, {
                label: 'Promedio MÃ³vil 7 dÃ­as',
                data: promedioMovil,
                borderColor: '#28a745',
                borderDash: [5, 5],
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'top' }
            }
        }
    });
    
    // GrÃ¡fico de parÃ¡metros
    new Chart(document.getElementById('chartEvolucionParametros'), {
        type: 'line',
        data: {
            labels: {{ fechas_parametros|safe }},
            datasets: [{
                label: 'Temperatura',
                data: {{ temp_data|safe }},
                borderColor: '#dc3545',
                fill: false
            }, {
                label: 'pH',
                data: {{ ph_data|safe }},
                borderColor: '#ffc107',
                fill: false
            }, {
                label: 'OxÃ­geno',
                data: {{ oxigeno_data|safe }},
                borderColor: '#17a2b8',
                fill: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false
        }
    });
</script>
{% endblock %}
